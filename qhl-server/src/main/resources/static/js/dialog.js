(function(a,b){if(typeof define==="function"&&define.amd){define(["$"],b)}else{if(typeof exports==="object"){module.exports=b()}else{a.Dialog=b(window.Zepto||window.jQuery||$)}}})(this,function(b){b.fn.Dialog=function(c){var d=[];b(this).each(function(){var f=new a();var e=b.extend({trigger:b(this)},c);f.init(e);d.push(f)});return d};b.Dialog=function(e){if(e.type==="alert"){var j=new a();var h='<div class="ui-alert-title">'+e.content+"</div>";var f="";if(e.button){if(typeof e.button=="boolean"){e.button="确定"}f='<p class="ui-dialog-action"><button class="ui-alert-submit  js-dialog-close">'+e.button+"</button></p>"}else{if(!e.timer){e.timer=3000}}h+=f;var c=b.extend({target:h,animate:true,show:true,mask:true,className:"ui-alert",afterHide:function(i){this.dispose();e.callback&&e.callback()}},e);j.init(c);if(e.timer){setTimeout(function(){j.dispose();e.callback&&e.callback()},e.timer)}j.touch(j.mask,function(){j.hide();e.callback&&e.callback()})}if(e.type==="confirm"){var k=new a();var h='<div class="ui-confirm-title">'+e.content+"</div>";var f="";if(!e.buttons){e.buttons=[{yes:"确定"},{no:"取消"}]}var o="";for(var g=0,d=e.buttons.length;g<d;g++){var m=e.buttons[g];if(m.yes){o+='<td><button class="ui-confirm-submit " data-type="yes">'+m.yes+"</button></td>"}if(m.no){o+='<td><button class="ui-confirm-no" data-type="no">'+m.no+"</button></td>"}if(m.close){o+='<td><button class="ui-confirm-close js-dialog-close" data-type="close">'+m.close+"</button></td>"}}f='<table class="ui-dialog-action"><tr>'+o+"</tr></table>";h+=f;var n=b.extend({target:h,animate:true,show:true,fixed:true,mask:true,className:"ui-alert",afterHide:function(i){this.dispose()},beforeShow:function(i){k.touch(b(".ui-confirm-submit",i),function(){e.callback&&e.callback.call(k,"yes",i)});k.touch(b(".ui-confirm-no",i),function(){e.callback&&e.callback.call(k,"no",i)});k.touch(b(".ui-confirm-close",i),function(){e.callback&&e.callback.call(k,"close",i)})}},e);k.init(n)}};b.alert=function(f,d,i,h,e){var c={};var g={zIndex:100,type:"alert"};if(typeof f=="object"){c=b.extend(g,f)}else{c=b.extend(g,{content:f,button:d,timer:h,callback:i})}b.Dialog(b.extend(c,e))};b.confirm=function(f,e,h,d){var c={};var g={zIndex:100,type:"confirm"};if(typeof f=="object"){c=b.extend(g,f)}else{c=b.extend(g,{content:f,buttons:e,callback:h})}b.Dialog(b.extend(c,d))};var a=function(){var c=Math.random().toString().replace(".","");this.id="dialog_"+c;this.settings={};this.settings.closeTpl=b('<span class="ui-dialog-close js-dialog-close">x</span>');this.settings.titleTpl=b('<div class="ui-dialog-title"></div>');this.timer=null;this.showed=false;this.mask=b()};a.prototype={init:function(c){var e=this;this.settings=b.extend({fixed:false},this.settings,c);if(this.settings.mask){this.mask=b('<div class="ui-dialog-mask"/>');b("body").append(this.mask)}b("body").append('<div class="ui-dialog" id="'+this.id+'"></div>');this.dialogContainer=b("#"+this.id);var d=this.settings.zIndex||10;this.dialogContainer.css({zIndex:d});if(this.settings.className){this.dialogContainer.addClass(this.settings.className)}this.mask.css({zIndex:d-1});if(this.settings.closeTpl){this.dialogContainer.append(this.settings.closeTpl)}if(this.settings.title){this.dialogContainer.append(this.settings.titleTpl);this.settings.titleTpl.html(this.settings.title)}this.bindEvent();if(this.settings.show){this.show()}},touch:function(f,d){var c;b(f).on("click",e);function e(g){return d.call(this,g)}b(f).on("touchmove",function(g){c=true}).on("touchend",function(g){g.preventDefault();if(!c){var h=d.call(this,g,"touch");if(!h){g.preventDefault();g.stopPropagation()}}c=false})},bindEvent:function(){var c=this;if(this.settings.trigger){b(this.settings.trigger).click(function(){c.show()});c.touch(b(this.settings.trigger),function(){c.show()})}b(this.dialogContainer).on("click",".js-dialog-close",function(){c.hide();return false});b(document).keydown(function(d){if(d.keyCode===27&&c.showed){c.hide()}});b(this.dialogContainer).on("hide",function(){c.hide()})},dispose:function(){this.dialogContainer.remove();this.mask.remove();this.timer&&clearInterval(this.timer)},hide:function(){var c=this;if(c.settings.beforeHide){c.settings.beforeHide.call(c,c.dialogContainer)}this.showed=false;this.mask.hide();this.timer&&clearInterval(this.timer);if(this.settings.animate){this.dialogContainer.removeClass("zoomIn").addClass("zoomOut");setTimeout(function(){c.dialogContainer.hide();if(typeof c.settings.target==="object"){b("body").append(c.dialogContainer.hide())}if(c.settings.afterHide){c.settings.afterHide.call(c,c.dialogContainer)}},500)}else{this.dialogContainer.hide();if(typeof this.settings.target==="object"){b("body").append(this.dialogContainer)}if(this.settings.afterHide){this.settings.afterHide.call(this,this.dialogContainer)}}},show:function(){if(typeof this.settings.target==="string"){if(/^(\.|\#\w+)/gi.test(this.settings.target)){this.dailogContent=b(this.settings.target)}else{this.dailogContent=b("<div>"+this.settings.target+"</div>")}}else{this.dailogContent=this.settings.target}this.mask.show();this.dailogContent.show();this.height=this.settings.height||"auto";this.width=this.settings.width||"auto";this.dialogContainer.append(this.dailogContent).show().css({height:this.height,width:this.width});if(this.settings.beforeShow){this.settings.beforeShow.call(this,this.dialogContainer)}this.showed=true;b(this.settings.trigger).blur();this.setPosition();var c=this;this.timer&&clearInterval(this.timer);if(this.settings.fixed){this.timer=setInterval(function(){c.setPosition()},1000)}if(this.settings.animate){this.dialogContainer.addClass("zoomIn").removeClass("zoomOut").addClass("animated")}},setPosition:function(){if(this.showed){var j=this;this.dialogContainer.show();this.height=this.settings.height;this.width=this.settings.width;if(isNaN(this.height)){this.height=(this.dialogContainer.outerHeight&&this.dialogContainer.outerHeight())||this.dialogContainer.height()}if(isNaN(this.width)){this.width=(this.dialogContainer.outerWidth&&this.dialogContainer.outerWidth())||this.dialogContainer.width()}var e=this.settings.clientHeight||document.documentElement.clientHeight||document.body.clientHeight;var h=this.settings.clientWidth||document.documentElement.clientWidth||document.body.clientWidth;var i=this.width/2;var d=this.height/2;var g=h/2-i;var f=e/2-d;g=Math.floor(Math.max(0,g));f=Math.floor(Math.max(0,f));var c="absolute";if(j.settings.fixed){c="fixed"}j.dialogContainer.css({position:c,top:f,left:g})}}};return a});