var htmlObj = {
	header : "",
	left : "",
	right : ""
};
var elemId = null;
function getAbsoluteLeft(b) {
	var c = document.getElementById(b);
	var a = c.offsetLeft;
	while (c.offsetParent != null) {
		oParent = c.offsetParent;
		a += oParent.offsetLeft;
		c = oParent
	}
	return a
}
function getAbsoluteTop(a) {
	var c = document.getElementById(a);
	var b = c.offsetTop + c.offsetHeight + 10;
	while (c.offsetParent != null) {
		oParent = c.offsetParent;
		b += oParent.offsetTop;
		c = oParent
	}
	return b
}
function getElementWidth(a) {
	x = document.getElementById(a);
	return x.clientHeight
}
var pickerEvent = {
	Init : function(f) {
		if (obj.year == -1) {
			dateUtil.getCurrent()
		}
		for ( var e in pickerHtml) {
			pickerHtml[e]()
		}
		var g = document.getElementById("calendar_choose");
		if (g != null) {
			document.body.removeChild(g)
		}
		var c = ' <div class="calendat-con">';
		c += '<table class="calendar-item"><tbody>';
		c += htmlObj.header;
		c += htmlObj.left;
		c += htmlObj.right;
		c += "</tbody></table>";
		c += "</div>";
		elemId = f;
		var a = document.getElementById(f);
		$(document.body).append(c);
		document.getElementById("picker_last").onclick = pickerEvent.getLast;
		document.getElementById("picker_next").onclick = pickerEvent.getNext;
		document.getElementById("picker_today").onclick = pickerEvent.getToday;
		document.getElementById("calendar_choose").style.left = getAbsoluteLeft(f)
				+ "px";
		document.getElementById("calendar_choose").style.top = getAbsoluteTop(f)
				+ "px";
		document.getElementById("calendar_choose").style.zIndex = 1000;
		var d = document.getElementById("calendar_tab").getElementsByTagName(
				"td");
		for ( var b = 0; b < d.length; b++) {
			if (d[b].getAttribute("date") != null
					&& d[b].getAttribute("date") != ""
					&& d[b].getAttribute("price") != "-1") {
				d[b].onclick = function() {
					commonUtil.chooseClick(this)
				}
			}
		}
	},
	getLast : function() {
		dateUtil.getLastDate();
		pickerEvent.Init(elemId)
	},
	getNext : function() {
		dateUtil.getNexDate();
		pickerEvent.Init(elemId)
	},
	getToday : function() {
		dateUtil.getCurrent();
		pickerEvent.Init(elemId)
	},
	setPriceArr : function(a) {
		obj.priceArr = a
	},
	remove : function() {
		var a = document.getElementById("calendar_choose");
		if (a != null) {
			document.body.removeChild(a)
		}
	},
	isShow : function() {
		var a = document.getElementById("calendar_choose");
		if (a != null) {
			return true
		} else {
			return false
		}
	}
};
function GetDateStr(e) {
	var b = new Date();
	b.setDate(b.getDate() + e);
	var f = b.getFullYear();
	var a = b.getMonth() + 1;
	var c = b.getDate();
	return f + "-" + a + "-" + c
}
var pickerHtml = {
	getHead : function() {
		var a = "<tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr>";
		htmlObj.header = a
	},
	getLeft : function() {
		var a = '<div class="calendat-con"><div class="calendata-title">'
				+ obj.year + "年" + obj.month + "月</div></div>";
		htmlObj.left = a
	},
	getRight : function() {
		var k = dateUtil.getLastDay();
		var a = dateUtil.getWeek();
		var e = "";
		var g = 0;
		for ( var d = 1; d <= 42; d++) {
			if (g == 0) {
				e += "<tr>"
			}
			var h = a > 0 ? a : 0;
			if ((d - 1) >= a && (d - h) <= k) {
				var f = commonUtil.getPrice((d - h));
				var j = "";
				var b = "";
				if (f != -1) {
					// 金钱
			//		j = "<dfn>¥</dfn>" + f
				}
				if (f != -1 && obj.year == new Date().getFullYear()
						&& obj.month == new Date().getMonth() + 1
						&& d - h == new Date().getDate()) {
					b = "class='current day2'"
				}
				//服务器时间
				if (obj.year == obj.date.getFullYear()
						&& obj.month == obj.date.getMonth() + 1
						&& d - h == obj.date.getDate()) {
					e += "<td  "
							+ b
							+ ' data-date="'
							+ obj.year
							+ "-"
							+ obj.month
							+ "-"
							+ (d - h)
							+ '" price="'
							+ f
							+ '" class="day2"><a href="orderchoose.html?date='
							+ obj.year + "-" + obj.month + "-" + (d - h)
							+ '&dealerId='+dealerId+'&oilname='+oilname
							+'&hkcVehicleOwnerInfoId='+vehicleOwnerId+'&serviceInfoId='+serviceInfoId
							+'&hkcVehicleInfoId='+vehicleInfoId+'"><em>今天</em><span>' + j + "</span></a></td>"
				} else {
					if (obj.year == obj.date.getFullYear()
							&& obj.month == obj.date.getMonth() + 1
							&& d - h == obj.date.getDate() + 1) {
						e += "<td  "
								+ b
								+ ' data-date="'
								+ obj.year
								+ "-"
								+ obj.month
								+ "-"
								+ (d - h)
								+ '" price="'
								+ f
								+ '"class="day2"><a href="orderchoose.html?date='
								+ obj.year + "-" + obj.month + "-" + (d - h)
								+ '&dealerId='+dealerId+'&oilname='+oilname
								+'&hkcVehicleOwnerInfoId='+vehicleOwnerId+'&serviceInfoId='+serviceInfoId
								+'&hkcVehicleInfoId='+vehicleInfoId+'"><em>明天</em><span>' + j
								+ "</span></a></td>"
					} else {
						if (obj.year == obj.date.getFullYear()
								&& obj.month == obj.date.getMonth() + 1
								&& d - h == obj.date.getDate() + 2) {
							e += "<td  "
									+ b
									+ ' data-date="'
									+ obj.year
									+ "-"
									+ obj.month
									+ "-"
									+ (d - h)
									+ '" price="'
									+ f
									+ '"class="day2"><a href="orderchoose.html?date='
									+ obj.year + "-" + obj.month + "-"
									+ (d - h) + '&dealerId='+dealerId+'&oilname='+oilname
									+'&hkcVehicleOwnerInfoId='+vehicleOwnerId+'&serviceInfoId='+serviceInfoId
									+'&hkcVehicleInfoId='+vehicleInfoId+'"><em>后天</em><span>' + j
									+ "</span></a></td>"
						} else {
							if (obj.year == obj.date.getFullYear()
									&& obj.month == obj.date.getMonth() + 1
									&& d - h < obj.date.getDate()) {
								e += '<td class="gray "><em>' + (d - h)
										+ "</em><span></span></td>"
							} else {
								e += '<td data-date="'
										+ obj.year
										+ "-"
										+ obj.month
										+ "-"
										+ (d - h)
										+ '" price="'
										+ f
										+ '" class="surplus-day"><a href="orderchoose.html?date='
										+ obj.year + "-" + obj.month + "-"
										+ (d - h) + '&dealerId='+dealerId+'&oilname='+oilname
										+'&hkcVehicleOwnerInfoId='+vehicleOwnerId+'&serviceInfoId='+serviceInfoId
											+'&hkcVehicleInfoId='+vehicleInfoId+'"><em>' + (d - h)
										+ "</em><span>" + j
										+ "</span></a></td>"
							}
						}
					}
				}
				if (g == 6) {
					e += "</tr>";
					g = -1
				}
			} else {
				e += "<td></td>";
				if (g == 6) {
					e += "</tr>";
					g = -1
				}
			}
			g++
		}
		htmlObj.right = e
	}
};
var dateUtil = {
	getWeek : function() {
		var a = new Date(obj.year, obj.month - 1, 1);
		return a.getDay()
	},
	getLastDay : function() {
		var c = obj.year;
		var a = obj.month;
		var b = new Date(c, a, 1);
		return (new Date(b.getTime() - 1000 * 60 * 60 * 24)).getDate()
	},
	getCurrent : function() {
		var a = obj.date;
		obj.year = a.getFullYear();
		obj.month = a.getMonth() + 1;
		obj.day = a.getDate()
	},
	getLastDate : function() {
		if (obj.year == -1) {
			var a = new Date(obj.date);
			obj.year = a.getFullYear();
			obj.month = a.getMonth() + 1
		} else {
			var b = obj.month - 1;
			if (b <= 0) {
				obj.year -= 1;
				obj.month = 12
			} else {
				var currentYear = new Date().getFullYear();
				var currentMonth = new Date().getMonth()+1;
				if(currentMonth == obj.month && currentYear == obj.year){
					return;
				}else{
					obj.month -= 1;
				}
			}
		}
		var today = new Date();
		var nextMonth =new Date(today.setMonth(today.getMonth() + 1));
		var n_yy = nextMonth.getFullYear();
		var n_mm = nextMonth.getMonth()+1;
		var n_dd = nextMonth.getDate();
		
		setTimeout(function(){
			
			 $('td.surplus-day').each(function() {
				
				
			  
					var tdUnit1 = $(this).attr('data-date');
					//console.log(tdUnit1);
					var tdUnit = tdUnit1.replace(/-/g,'/');
					console.log(tdUnit);
					if(Date.parse(new Date(tdUnit)) > Date.parse(new Date(n_yy+'/'+n_mm+'/'+n_dd))){
						$(this).removeClass('surplus-day').addClass('gray');
						$(this).children('a').attr('href','javascript:void(0)');
					}
				
            });

		},50);
	},
	getNexDate : function() {
		if (obj.year == -1) {
			var a = new Date(obj.date);
			obj.year = a.getFullYear();
			obj.month = a.getMonth() + 1
		} else {
			var b = obj.month + 1;
			if (b > 12) {
				obj.year += 1;
				obj.month = 1
			} else {
				obj.month += 1
			}
		}
		var today = new Date();
		var nextMonth =new Date(today.setMonth(today.getMonth() + 1));
		var n_yy = nextMonth.getFullYear();
		var n_mm = nextMonth.getMonth()+1;
		var n_dd = nextMonth.getDate();
		
		setTimeout(function(){
			
			 $('td.surplus-day').each(function() {
				
				
			  
					var tdUnit1 = $(this).attr('data-date');
					//console.log(tdUnit1);
					var tdUnit = tdUnit1.replace(/-/g,'/');
					console.log(tdUnit);
					if(Date.parse(new Date(tdUnit)) > Date.parse(new Date(n_yy+'/'+n_mm+'/'+n_dd))){
						$(this).removeClass('surplus-day').addClass('gray');
						$(this).children('a').attr('href','javascript:void(0)');
					}
				
            });

		},50);
	}
};
var commonUtil = {
	getPrice : function(a) {
		var c = obj.year + "-";
		if (obj.month < 10) {
			c += "0" + obj.month
		} else {
			c += obj.month
		}
		if (a < 10) {
			c += "-0" + a
		} else {
			c += "-" + a
		}
		for ( var b = 0; b < obj.priceArr.length; b++) {
			if (obj.priceArr[b].Date == c) {
				return obj.priceArr[b].Price.split(".")[0]
			}
		}
		return -1
	},
	chooseClick : function(b) {
		var a = b.getAttribute("date");
		var d = b.getAttribute("price");
		var c = document.getElementById(elemId);
		if (c != null) {
			c.value = a;
			alert("日期是：" + a);
			alert("价格是：￥" + d);
			pickerEvent.remove()
		}
	}
};
$(document).bind("click", function(b) {
	var c = b || window.event;
	var a = c.srcElement || c.target;
	while (a) {
		if (a.id == "calendar_choose") {
			return
		}
		a = a.parentNode
	}
	pickerEvent.remove()
});